<!DOCTYPE html>
<html lang="en-US">
<body background="images/background.png">
    <head>
        <meta charset="utf-8"> 
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="author" content="LCY.Hugepanda" />
        <meta name="copyright" content="LCY.Hugepanda" />
		
<head>
    <style>
        .bannerbox {
            width:100%;
            position:relative;
            overflow:hidden;
            height:140px;
        }
        .banner {
            width:1500px;
            position:absolute;
            left:50%;
            margin-left:-800px;
        }
    </style>
</head>
<body>
    <div class="bannerbox">
        <div class="banner">
            <img src="images\\LCYbanner.png">
        </div>
    </div> 
</body>
        <meta property="og:type" content="article" />
        <meta name="twitter:card" content="summary">

<meta name="keywords" content="Python, Whoosh, Python, " />

<meta property="og:title" content="使用Whoosh实现简单的文本检索 "/>
<meta property="og:url" content="/shi-yong-whooshshi-xian-jian-dan-de-wen-ben-jian-suo.html" />
<meta property="og:description" content="使用Whoosh实现简单的文本检索¶文本检索是很多NLP任务的重要组成部分，也是信息检索（IR, Information Retrieval）领域的重要研究问题。本文并不考虑复杂的NLP任务，也不考虑IR研究中涉及的复杂问题，仅从“简单够用”的角度，给出一种实现参考。 这里用到了开源软件Whoosh，这是一个Python实现的搜索服务框架，此处使用的是Whoosh 2.6.0版本。 测试用到的语料是PFR人民日报语料库，通过预处理我只保留了分词结果。在后面的测试中，我认为每一个完整的句子（句号分隔）是一条记录。 （不要在意这些细节，这只是个简单的示例^(*￣(oo)￣)^） ① 设定Whoosh的Schema¶这个Schema指定了记录的标题、内容、标识符等信息的类型，由于我们的目标是文本检索，所以标题和内容都是TEXT，Schema还有很多别的设定，比如可以设定记录的关键字等等。 变量ix是搜索的关键：索引。 In [1]: import os from whoosh.index import create_in ..." />
<meta property="og:site_name" content="LCY Data Science Couple" />
<meta property="og:article:author" content="LCY.Hugepanda" />
<meta property="og:article:published_time" content="2015-04-15T11:02:00+08:00" />
<meta name="twitter:title" content="使用Whoosh实现简单的文本检索 ">
<meta name="twitter:description" content="使用Whoosh实现简单的文本检索¶文本检索是很多NLP任务的重要组成部分，也是信息检索（IR, Information Retrieval）领域的重要研究问题。本文并不考虑复杂的NLP任务，也不考虑IR研究中涉及的复杂问题，仅从“简单够用”的角度，给出一种实现参考。 这里用到了开源软件Whoosh，这是一个Python实现的搜索服务框架，此处使用的是Whoosh 2.6.0版本。 测试用到的语料是PFR人民日报语料库，通过预处理我只保留了分词结果。在后面的测试中，我认为每一个完整的句子（句号分隔）是一条记录。 （不要在意这些细节，这只是个简单的示例^(*￣(oo)￣)^） ① 设定Whoosh的Schema¶这个Schema指定了记录的标题、内容、标识符等信息的类型，由于我们的目标是文本检索，所以标题和内容都是TEXT，Schema还有很多别的设定，比如可以设定记录的关键字等等。 变量ix是搜索的关键：索引。 In [1]: import os from whoosh.index import create_in ...">
<meta property="og:image" content="images/150415-feature.png" />
<meta name="twitter:image" content="images/150415-feature.png" >

        <title>使用Whoosh实现简单的文本检索  · LCY Data Science Couple
</title>
        <link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.min.css" rel="stylesheet">
        <link href="//netdna.bootstrapcdn.com/font-awesome/4.0.1/css/font-awesome.css" rel="stylesheet">
        <link rel="stylesheet" type="text/css" href="/theme/css/pygments.css" media="screen">
        <link rel="stylesheet" type="text/css" href="/theme/tipuesearch/tipuesearch.css" media="screen">
        <link rel="stylesheet" type="text/css" href="/theme/css/elegant.css" media="screen">
        <link rel="stylesheet" type="text/css" href="/theme/css/custom.css" media="screen">
    </head>
    <body>
        <div id="content-sans-footer">
        <div class="navbar navbar-static-top">
            <div class="navbar-inner">
                <div class="container-fluid">
                    <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </a>
                    <a class="brand" href="/"><span class=site-name>LCY Data Science Couple</span></a>
                    <div class="nav-collapse collapse">
                        <ul class="nav pull-right top-menu">
                            <li ><a href="">Home</a></li>
                            <li ><a href="/categories.html">Categories</a></li>
                            <li ><a href="/tags.html">Tags</a></li>
                            <li ><a href="/archives.html">Archives</a></li>
							<li ><a href="/skill.html">Skill Tree</a></li>
                            <li><form class="navbar-search" action="/search.html" onsubmit="return validateForm(this.elements['q'].value);"> <input type="text" class="search-query" placeholder="Search" name="q" id="tipue_search_input"></form></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <div class="container-fluid">
            <div class="row-fluid">
                <div class="span1"></div>
                <div class="span10">
<article>
<div class="row-fluid">
    <header class="page-header span10 offset2">
    <h1><a href="/shi-yong-whooshshi-xian-jian-dan-de-wen-ben-jian-suo.html"> 使用Whoosh实现简单的文本检索  </a></h1>
    </header>
</div>

<div class="row-fluid">
        <div class="span8 offset2 article-content">

            
            
  <div tabindex="-1" id="notebook" class="border-box-sizing">
    <div class="container" id="notebook-container">

<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="使用Whoosh实现简单的文本检索">&#20351;&#29992;Whoosh&#23454;&#29616;&#31616;&#21333;&#30340;&#25991;&#26412;&#26816;&#32034;<a class="anchor-link" href="#使用Whoosh实现简单的文本检索">&#182;</a></h2><p>文本检索是很多NLP任务的重要组成部分，也是信息检索（IR, Information Retrieval）领域的重要研究问题。本文并不考虑复杂的NLP任务，也不考虑IR研究中涉及的复杂问题，仅从“简单够用”的角度，给出一种实现参考。</p>
<p>这里用到了开源软件<a href="http://pythonhosted.org/Whoosh/intro.html" title="Whoosh">Whoosh</a>，这是一个Python实现的搜索服务框架，此处使用的是Whoosh 2.6.0版本。</p>
<p>测试用到的语料是<a href="http://www.icl.pku.edu.cn/icl_groups/corpus/dwldform1.asp" title="PFR人民日报语料库">PFR人民日报语料库</a>，通过预处理我只保留了分词结果。在后面的测试中，我认为每一个完整的句子（句号分隔）是一条记录。</p>
<p>（不要在意这些细节，这只是个简单的示例^(*￣(oo)￣)^）</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="①-设定Whoosh的Schema">&#9312; &#35774;&#23450;Whoosh&#30340;Schema<a class="anchor-link" href="#①-设定Whoosh的Schema">&#182;</a></h3><p>这个Schema指定了记录的标题、内容、标识符等信息的类型，由于我们的目标是文本检索，所以标题和内容都是TEXT，Schema还有很多别的设定，比如可以设定记录的关键字等等。
变量ix是搜索的关键：索引。</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[1]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span class="kn">import</span> <span class="nn">os</span>

<span class="kn">from</span> <span class="nn">whoosh.index</span> <span class="kn">import</span> <span class="n">create_in</span>
<span class="kn">from</span> <span class="nn">whoosh.fields</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">schema</span> <span class="o">=</span> <span class="n">Schema</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">TEXT</span><span class="p">(</span><span class="n">stored</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span> <span class="n">path</span><span class="o">=</span><span class="n">ID</span><span class="p">(</span><span class="n">stored</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span> <span class="n">content</span><span class="o">=</span><span class="n">TEXT</span><span class="p">)</span>
<span class="n">ix</span> <span class="o">=</span> <span class="n">create_in</span><span class="p">(</span><span class="s">&quot;Exp0131_files&quot;</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="s">&quot;index&quot;</span><span class="p">,</span> <span class="n">schema</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="②-读入语料，建立索引">&#9313; &#35835;&#20837;&#35821;&#26009;&#65292;&#24314;&#31435;&#32034;&#24341;<a class="anchor-link" href="#②-读入语料，建立索引">&#182;</a></h3><p>这是实现搜索的一个重要手段，即对每一条记录建立索引记录，为了示意方便，我们把每一条记录的内容都写到title中，内容content留空。</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[2]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span class="n">idx</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">writer</span> <span class="o">=</span> <span class="n">ix</span><span class="o">.</span><span class="n">writer</span><span class="p">()</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">&quot;Exp0131_files&quot;</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="s">&quot;textbase.txt&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fin</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">fin</span><span class="p">:</span>
        <span class="n">writer</span><span class="o">.</span><span class="n">add_document</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">line</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s">&#39;utf-8&#39;</span><span class="p">),</span> <span class="n">path</span><span class="o">=</span><span class="s">u&quot;Id: </span><span class="si">%d</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">idx</span><span class="p">,</span><span class="n">content</span><span class="o">=</span><span class="s">u&#39;N/A&#39;</span><span class="p">)</span>
        <span class="n">idx</span> <span class="o">+=</span> <span class="mi">1</span>
        
<span class="n">writer</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
<span class="k">print</span> <span class="s">&#39;</span><span class="si">%d</span><span class="s"> records loaded.&#39;</span> <span class="o">%</span> <span class="n">idx</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>231189 records loaded.
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="③-检索测试">&#9314; &#26816;&#32034;&#27979;&#35797;<a class="anchor-link" href="#③-检索测试">&#182;</a></h3><p>索引建立完成之后，就可以进行检索测试，默认的Whoosh支持简单的AND OR用法，这里简单示意一个如下</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[5]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span class="o">%%</span><span class="k">time</span>
from whoosh.qparser import QueryParser

with ix.searcher() as searcher:
    query = QueryParser(&quot;title&quot;, ix.schema).parse(u&quot;新闻 AND 美国 OR 日本&quot;)
    results = searcher.search(query)
    if results:
        for res in results:
            print res[&#39;title&#39;]
    else:
        print &#39;Not found&#39;
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>有 一个 现象 引起 了 我 的 注意 ，今年 来 采访 “ 两会 ” 的 外国 记者 中 ，前 7 位 的 国家 是 日本 、 美国 、 英国 、 德国 、 韩国 、 法国 、 加拿大 ，而 日本 、 美国 的 主要 新闻 媒体 派出 的 记者 近 200 人 ，占 采访 “ 两会 ” 外国 记者 总数 的 一半 ，说明 发达国家 对 中国 的 关注 程度 。

当 记者 今晨 在 饭桌 上 与 美国 《 新闻 周刊 》 和 法国 《 费加罗 报 》 记者 交换 看法 时 ，新闻 已 成为 “ 旧闻 ” 。

中国 和 美国 远 隔 重洋 ，两 国 人民 间 的 相互 了解 很多 要 通过 新闻 媒体 。

我 知道 美国 人民 不 会 这么 做 的 ，怎么 能 把 战争 物资 卖 给 一个 侵略 国家 呢 ？‘ 是的 ，’ 他 肯定 地 说 ，‘ 消息 来源 ，就 是 你们 美国 的 新闻 电讯 。

美国 《 新闻 周刊 》 甚至 用 “ 德国 病 ” 这样 的 概念 描述 德国 经济 现状 。

他 在 会谈 后 举行 的 新闻 发布会 上 表示 ，美国 将 继续 支持 埃及 的 军事 现代化 计划 。

奥尔布赖特 在 抵达 科威特 后 接受 美国 有线 新闻 广播 公司 记者 采访 时 说 ，美国 并 不 认为 ，美国 需要 联合国 安理会 通过 一 项 新 的 决议 之后 才 能 对 伊拉克 动武 。

例如 ，日本 的 索尼 公司 在 80 年代 末 以后 大举 投资 新闻 媒体 和 娱乐业 ，在 1989年 买 下 美国 哥伦比亚 影片 和 法国 的 特莱玛 音乐 制作 公司 ，随后 同 美国 的 布洛克巴斯特 影视 公司 和 时代 — 沃纳 公司 合资 建立 了 几 个 广播 公司 ，还 与 一些 电视 、 电影 制作 公司 进行 了 合资 。

我们 国家 也 有 犯罪 ，也 有 流浪 街头 的 孩子 ，却 没 人 过问 。 ”美国 新闻 代表团 团长 曾 这样 感慨 。

最新 一 期 《 美国 新闻 和 世界 报道 》 周刊 援引 美国 众议院 的 报告 说 ，伊拉克 曾 于 1991年 夏 把 化学武器 和 400 枚 飞毛腿 导弹 转移 到 也门 和 苏丹 。

Wall time: 179 ms
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="结语">&#32467;&#35821;<a class="anchor-link" href="#结语">&#182;</a></h2><p>很显然，本文仅仅是一个最简单的入门示例，这个过程中存在很多问题，例如：</p>
<ul>
<li>检索的过程中，并没有加入检索词的模糊性，目前的检索要求检索词必须精确匹配</li>
<li>索引和检索的速度很慢，在上面的例子中，建立索引大概用了五分钟，单次检索的用时也在百毫秒级别（只有二十多万记录而已）</li>
</ul>
<p>这些问题在实际中大概需要逐一解决，值得庆幸的是Whoose在设计时就把自己定位在一个框架，因此功能的扩展（估计）并不会很难。最后引用Whoose文档中的一段话，用来说明Whoose的定位：</p>
<blockquote><p>Whoosh is a fast, pure Python search engine library.</p>
<p>The primary design impetus of Whoosh is that it is pure Python. You should be able to use Whoosh anywhere you can use Python, no compiler or Java required.</p>
<p>Like one of its ancestors, Lucene, Whoosh is not really a search engine, it’s a programmer library for creating a search engine [1].</p>
<p>Practically no important behavior of Whoosh is hard-coded. Indexing of text, the level of information stored for each term in each field, parsing of search queries, the types of queries allowed, scoring algorithms, etc. are all customizable, replaceable, and extensible.</p>
<p>[1]    It would of course be possible to build a turnkey search engine on top of Whoosh, like Nutch and Solr use Lucene.</p>
</blockquote>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[&nbsp;]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre> 
</pre></div>

</div>
</div>
</div>

</div>
    </div>
  </div>

            
            
            <hr/>
        </div>
        <section>
        <div class="span2" style="float:right;font-size:0.9em;">
            <h4>Published</h4>
            <time pubdate="pubdate" datetime="2015-04-15T11:02:00+08:00">四月 15, 2015</time>
            <h4>Category</h4>
            <a class="category-link" href="/categories.html#python-ref">Python</a>
            <h4>Tags</h4>
            <ul class="list-of-tags tags-in-article">
                <li><a href="/tags.html#python-ref">Python
                    <span>3</span>
</a></li>
                <li><a href="/tags.html#whoosh-ref">Whoosh
                    <span>1</span>
</a></li>
            </ul>
<h4>Contact</h4>
    <a href="#" title="My You can add links in your config file Profile" class="sidebar-social-links" target="_blank">
    <i class="fa fa-you can add links in your config file sidebar-social-links"></i></a>
    <a href="#" title="My Another social link Profile" class="sidebar-social-links" target="_blank">
    <i class="fa fa-another social link sidebar-social-links"></i></a>
        </div>
        </section>
</div>
</article>
                </div>
                <div class="span1"></div>
            </div>
        </div>
        <div id="push"></div>
    </div>
<footer>
<div id="footer">
    <ul class="footer-content">
        <li class="elegant-power">Powered by <a href="http://getpelican.com/" title="Pelican Home Page">Pelican</a>. Theme: <a href="http://oncrashreboot.com/pelican-elegant" title="Theme Elegant Home Page">Elegant</a> by <a href="http://oncrashreboot.com" title="Talha Mansoor Home Page">Talha Mansoor</a></li>
    </ul>
</div>
</footer>            <script src="http://code.jquery.com/jquery.min.js"></script>
        <script src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
        <script>
            function validateForm(query)
            {
                return (query.length > 0);
            }
        </script>

    
    </body>
    <!-- Theme: Elegant built for Pelican
    License : http://oncrashreboot.com/pelican-elegant -->
</body>
</html>